<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Attendance Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  margin:0;
  font-family:"Segoe UI",Tahoma,sans-serif;
  background:#020617;
  color:#e5e7eb;
}
header{
  background:#0f172a;
  padding:15px;
  text-align:center;
  font-size:20px;
  font-weight:bold;
}
.container{padding:20px}
.date-box{text-align:center;margin-bottom:20px}
.date-box input{
  background:#020617;
  color:#fff;
  border:1px solid #334155;
  padding:8px 12px;
  border-radius:8px;
}
.cards{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:15px;
}
.card{
  background:#0f172a;
  padding:20px;
  border-radius:12px;
  text-align:center;
}
.departments{
  margin-top:30px;
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(340px,1fr));
  gap:15px;
}
.dept-card{
  background:#0f172a;
  padding:15px;
  border-radius:12px;
}
.dept-card h4{
  text-align:center;
  color:#c7d2fe;
}
.split{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
  margin-top:10px;
}
.box{
  background:#020617;
  border-radius:8px;
  padding:10px;
  font-size:13px;
}
.box h5{
  margin:0 0 5px;
  color:#93c5fd;
}
canvas{margin-top:30px}
</style>
</head>

<body>

<header>Attendance Dashboard</header>

<div class="container">

<div class="date-box">
  <input type="date" id="datePicker">
</div>

<div class="cards">
  <div class="card"><h3>إجمالي المهندسين</h3><p>32</p></div>
  <div class="card"><h3>حضر</h3><p id="inCount">0</p></div>
  <div class="card"><h3>غاب</h3><p id="outCount">32</p></div>
</div>

<canvas id="deptChart" height="120"></canvas>

<div class="departments" id="departmentsBox"></div>

</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycby9We83tXmtxG_1ykdriEXyASO_685z1ieBrMb9HJpRdEYs8KXhzAkjFyaCchjgwoQAzg/exec";

const ENGINEERS = [
"محمد عبداللطيف عبد الحميد علي",
"Efat Youssef Assad Hanna",
"Waleed Mahmoud Ismaiel Abdelrahim",
"Ahmed Abdelnasser Mohamed Aly",
"Amr Abdullah Abdrabbo Hlhil",
"Wael Ibrahim Eid Mohamed",
"Aly Aboseif Abdelbadea Aly Abosaif",
"Mahmoud Fathy Youssef Ismail",
"Hussien Kamel Abdelkarem Abdelelamam",
"Reda Mekhemar Abdelhamid Abdelhakim",
"Mohamed Khaled Mohamed Khaled",
"Alaaeldien Mohamed Soliman AbdelhAlym",
"Afraim Shawky Mikhail Habashy",
"Mohamed Hussien Mohamed Ahmed",
"Ahmed Abdelfattah Aly Aly",
"Mohamed Moustafa Abdelrahman Reyad",
"Abdullah Shaaban Saad Mourad",
"Elfarouk Mohamed Ahmed Mohamed",
"Essam Sayed Mohamed Seddik",
"Eltawab Mahmoud Aly Aboelhassan",
"Ibrahim Abdelnaser Abdelshafy Abdellatif",
"Mohamed Saeed Aboelhagag Hassan",
"Ahmed Mohamed Farouk Abdelrheam",
"Ahmed Rabie Abdelrazik Hussien",
"Mohamed Atef Mahmoud Elgeneidy",
"Ali Ahmed Hassan Hamed",
"Assem Hassan Abdelshafy Hassan",
"Omar Metwally Ahmed Mohamed Salem",
"Abdelmoneam Hassan Hafez Karrat",
"Mahmoud Ramadan Mahmoud Abdelaziz",
"Mahmoud Khaled",
"Mohamed Youssef"
];

const DEPARTMENTS = [
"بنى سويف",
"شمال المنيا",
"توريدات",
"آلى",
"جنوب المنيا",
"متابعه"
];

const TOTAL = ENGINEERS.length;
let chart;

const dateInput = document.getElementById("datePicker");
dateInput.value = new Date().toLocaleDateString("en-CA");
dateInput.addEventListener("change", loadDashboard);

function loadDashboard(){
  fetch(`${API_URL}?action=attendance&date=${dateInput.value}`)
  .then(r=>r.json())
  .then(rows=>{
    const present = {};
    const deptData = {};
    DEPARTMENTS.forEach(d=>deptData[d]=[]);

    rows.forEach(r=>{
      if(r.status==="IN"){
        present[r.name]=true;
        if(deptData[r.department]){
          deptData[r.department].push({
            name:r.name,
            location:r.location
          });
        }
      }
    });

    const presentCount = Object.keys(present).length;
    document.getElementById("inCount").textContent = presentCount;
    document.getElementById("outCount").textContent = TOTAL - presentCount;

    const box = document.getElementById("departmentsBox");
    box.innerHTML="";

    const chartIn=[], chartOut=[];

    DEPARTMENTS.forEach(dept=>{
      const inNames = deptData[dept];
      const outNames = ENGINEERS.filter(e=>!present[e]);

      chartIn.push(inNames.length);
      chartOut.push(TOTAL - inNames.length);

      box.innerHTML+=`
      <div class="dept-card">
        <h4>${dept}</h4>
        <div class="split">
          <div class="box">
            <h5>حضر (${inNames.length})</h5>
            ${inNames.map(n=>`${n.name} - ${n.location}`).join("<br>")||"-"}
          </div>
          <div class="box">
            <h5>غاب</h5>
            ${outNames.join("<br>")}
          </div>
        </div>
      </div>`;
    });

    drawChart(chartIn,chartOut);
  });
}

function drawChart(inData,outData){
  if(chart) chart.destroy();
  chart=new Chart(document.getElementById("deptChart"),{
    type:"bar",
    data:{
      labels:DEPARTMENTS,
      datasets:[
        {label:"حضر",data:inData,backgroundColor:"#60a5fa"},
        {label:"غاب",data:outData,backgroundColor:"#a5b4fc"}
      ]
    },
    options:{
      responsive:true,
      plugins:{legend:{labels:{color:"#e5e7eb"}}},
      scales:{
        x:{ticks:{color:"#e5e7eb"}},
        y:{ticks:{color:"#e5e7eb"}}
      }
    }
  });
}

loadDashboard();
</script>

</body>
</html>
